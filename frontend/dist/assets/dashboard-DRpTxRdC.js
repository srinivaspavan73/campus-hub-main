import{u as Q,c as q,r as c,j as e}from"./index-oRpEOpm0.js";import{u as J}from"./userAtom-CADv8YHu.js";import{a as h}from"./axios-upsvKRUO.js";function K(){var U,D,B,M;const m=Q(),a=q(J),[b,f]=c.useState([]),[T,v]=c.useState(!0),[N,A]=c.useState(null),[t,$]=c.useState(null),[y,w]=c.useState(!1),[g,x]=c.useState({show:!1,message:"",type:""}),[d,u]=c.useState("");c.useEffect(()=>{const s=localStorage.getItem("token");if(!s){m("/signin");return}h.defaults.headers.common.Authorization=`Bearer ${s}`,(async()=>{var l,n,o;try{v(!0);const[i,H]=await Promise.all([h.get("http://localhost:5000/user/profile"),h.get("http://localhost:5000/user/events")]);$(i.data.user),f(H.data.events||[])}catch(i){console.error("Error fetching data:",i),A(((n=(l=i.response)==null?void 0:l.data)==null?void 0:n.msg)||"Failed to load dashboard data"),((o=i.response)==null?void 0:o.status)===401&&(localStorage.removeItem("token"),m("/signin"))}finally{v(!1)}})()},[m]);const F=["./bg1.svg","./bg2.svg","./bg3.svg","./bg4.svg","./bg5.svg","./bg6.svg","./bg7.svg"],I=()=>Math.floor(Math.random()*6),z=async s=>{var r,l;try{w(!0);const n=await h.post(`http://localhost:5000/user/register-event/${s}`);f(o=>o.map(i=>i.id===s?{...i,attendees:[...i.attendees||[],t.id]}:i)),x({show:!0,message:n.data.msg||"Registered successfully!",type:"success"}),setTimeout(()=>{x({show:!1,message:"",type:""})},3e3)}catch(n){console.error("Registration error:",n),x({show:!0,message:((l=(r=n.response)==null?void 0:r.data)==null?void 0:l.msg)||"Failed to register for event",type:"error"}),setTimeout(()=>{x({show:!1,message:"",type:""})},3e3)}finally{w(!1)}},W=()=>{localStorage.removeItem("token"),m("/")},E=s=>!t||!t.id?!1:Array.isArray(s.attendees)&&s.attendees.some(r=>r.id===t.id),k=s=>{if(!d.trim())return s;const r=d.toLowerCase();return s.filter(l=>{var n,o,i;return((n=l.title)==null?void 0:n.toLowerCase().includes(r))||((o=l.description)==null?void 0:o.toLowerCase().includes(r))||((i=l.location)==null?void 0:i.toLowerCase().includes(r))})},C=b.filter(s=>E(s)),L=b.filter(s=>!E(s)),p=k(C),j=k(L);if(T)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-700",children:"Loading dashboard..."})]})});if(N)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center p-8 bg-white rounded-lg shadow-lg max-w-md",children:[e.jsx("div",{className:"text-red-500 text-5xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Error Loading Dashboard"}),e.jsx("p",{className:"text-gray-600 mb-4",children:N}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition",children:"Try Again"})]})});const _=(s,r)=>{const n=new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return r?`${n} at ${r}`:n},R=({event:s,isRegistered:r})=>e.jsxs("div",{className:"border rounded-lg overflow-hidden hover:shadow-md transition",children:[e.jsx("div",{className:"h-40 bg-blue-100 flex items-center justify-center",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-full object-cover",onError:l=>l.currentTarget.style.display="none"}):e.jsx("div",{className:"flex items-center justify-center w-full h-full bg-gray-200",children:e.jsx("img",{src:F[I()],alt:s.title,className:"w-full h-full object-contain",onError:l=>l.currentTarget.style.display="none"})})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800",children:s.title}),e.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-600",children:[e.jsx("span",{className:"mr-2",children:"ğŸ“…"}),e.jsx("span",{children:_(s.date,s.time)})]}),e.jsxs("div",{className:"mt-1 flex items-center text-sm text-gray-600",children:[e.jsx("span",{className:"mr-2",children:"ğŸ“"}),e.jsx("span",{children:s.location||"On Campus"})]}),e.jsx("p",{className:"mt-3 text-gray-600 text-sm line-clamp-2",children:s.description||"Join us for this exciting event!"}),e.jsx("div",{className:"mt-4",children:r?e.jsx("div",{className:"px-4 py-2 bg-green-100 text-green-800 rounded-md text-center",children:"âœ“ Registered"}):e.jsx("button",{onClick:()=>z(s.id),disabled:y,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:bg-blue-300",children:y?"Registering...":"Register Now"})})]})]}),S=({message:s,filteredBySearch:r})=>e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("p",{className:"text-gray-500",children:s}),r&&e.jsx("button",{onClick:()=>u(""),className:"mt-3 text-blue-600 hover:underline",children:"Clear search filter"})]});return e.jsxs("div",{className:"min-h-screen bg-gray-50 ",children:[g.show&&e.jsx("div",{className:`fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg ${g.type==="success"?"bg-green-100 text-green-800 border-l-4 border-green-500":"bg-red-100 text-red-800 border-l-4 border-red-500"} transition-opacity z-50`,children:g.message}),e.jsx("header",{className:"bg-white shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"CampusHub"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 flex items-center justify-center rounded-full bg-blue-500 text-white font-medium",children:((U=a==null?void 0:a.username)==null?void 0:U.charAt(0).toUpperCase())||((D=t==null?void 0:t.username)==null?void 0:D.charAt(0).toUpperCase())}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600 text-left",children:"Hello,"}),e.jsx("p",{className:"font-medium",children:(a==null?void 0:a.username)||(t==null?void 0:t.username)})]})]}),e.jsx("button",{onClick:W,className:"px-3 py-1 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition text-sm",children:"Logout"})]})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden mb-8",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search events by title, description, or location...",value:d,onChange:s=>u(s.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"}),d&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{onClick:()=>u(""),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}),d&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Found ",p.length+j.length,' events matching "',d,'"']})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 bg-blue-600 text-white",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Profile"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx("div",{className:"h-20 w-20 rounded-full bg-blue-100 flex items-center justify-center text-2xl font-bold text-blue-600",children:(((B=t==null?void 0:t.username)==null?void 0:B[0])||((M=a==null?void 0:a.username)==null?void 0:M[0])||"U").toUpperCase()})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),e.jsx("p",{className:"font-medium",children:(t==null?void 0:t.username)||(a==null?void 0:a.username)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"font-medium",children:(t==null?void 0:t.email)||(a==null?void 0:a.email)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Student ID"}),e.jsx("p",{className:"font-medium",children:(t==null?void 0:t.username)||(a==null?void 0:a.username)||"Not available"})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-3 space-y-8",children:e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b bg-blue-50",children:[e.jsx("h2",{className:"text-xl font-semibold text-blue-800",children:"Events to Register"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Upcoming campus events"})]}),e.jsx("div",{className:"p-6",children:j.length===0?e.jsx(S,{message:d?"No available events match your search criteria.":"No upcoming events available at this time.",filteredBySearch:d&&L.length>0}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:j.map(s=>e.jsx(R,{event:s,isRegistered:!1},s.id))})}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b bg-green-50",children:[e.jsx("h2",{className:"text-xl font-semibold text-green-800",children:"My Registered Events"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Events you are attending"})]}),e.jsx("div",{className:"p-6",children:p.length===0?e.jsx(S,{message:d?"No registered events match your search criteria.":"You haven't registered for any events yet.",filteredBySearch:d&&C.length>0}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:p.map(s=>e.jsx(R,{event:s,isRegistered:!0},s.id))})})]})]})})]})]})]})}export{K as default};
